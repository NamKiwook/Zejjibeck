doctype html
html
  head
    include head.pug
    link(rel='stylesheet', href='stylesheets/upload.css')
  body
    include dashboardLayout
    .container
      section.textWrap
        .title Project Name
        input.text#projectName(type='text')
      section.textWrap
        .title Project Description
        input.text#description(type='text')
      section.textWrap
        .title Credit
        input.text#credit(type='number')
      section.textWrap
        .title Minimum Number of Refine
        input.text#refine(type='number')
      section.typeWrap
        p.title Project Type
        label.radioWrap Only Data
          input.type(type="radio", name="projectType", value="data")
          span.radiomark
        label.radioWrap Only Refine
          input.type(type="radio", name="projectType", value="refine")
          span.radiomark
        label.radioWrap Data/Refine
          input.type(type="radio", name="projectType", value="data&refine")
          span.radiomark
      section.typeWrap
        p.title Data Type
        label.radioWrap Image
          input.type#typeImg(type="radio", name="dataType", value="image")
          span.radiomark
        label.radioWrap Audio
          input.type(type="radio", name="dataType", value="audio")
          span.radiomark
        label.radioWrap Text
          input.type(type="radio", name="dataType", value="text")
          span.radiomark
      section.tagTypeWrap
        p.title Refine Type
        label.radioWrap Radio
          input.tagType#radioTag(type="radio", name="refineType", value="radio")
          span.radiomark
        label.radioWrap Check box
          input.tagType#checkboxTag(type="radio", name="refineType", value="checkbox")
          span.radiomark
        label.radioWrap Text
          input.tagType(type="radio", name="refineType", value="text")
          span.radiomark
        label.radioWrap#dragType Drag
          input.tagType(type="radio", name="refineType", value="drag")
          span.radiomark
      section.tagValue
        .title Tag Value
        .valueWrap
          .textWrap#valueField
            input.text(type='text')
          .btnWrap
            a#plus.btn +
      section.upload
        .title Upload
        form#ajaxFrom(enctype="multipart/form-data")
          input#ajaxFile(type="file", multiple="multiple")
          input(type="button", onclick="upload();", value="업로드")
          //.btn.register REGISTER

script.
  $(document).ready(function(){
    $('#upload').addClass('active');

      // image type일때 drag 추가
    $('.type').change(function(){
      if ($('#typeImg').is(":checked")) {
        $('#dragType').css('display', 'inline-block');
      } else {
        $('#dragType').css('display', 'none');
      }
    })

    $('.tagType').change(function(){
      if($('#radioTag').is(":checked") || $('#checkboxTag').is(":checked")){
        $('.tagValue').css('display', 'flex');
      }else{
        $('.tagValue').css('display', 'none');
      }
    })

    // input field 동적생성
    var maxFields = 5;
    var x = 1;
    $('#plus').click(function(){
      if(x < maxFields) {
        x++;
        $('#valueField').append('<input class="text" type="text"/>');
      }
    })
  })

  // $('.register').click(upload())

  function upload() {
    var projectName = String(document.getElementById('projectName').value);
    var refine = String(document.getElementById('refine').value);
    var credit = String(document.getElementById('credit').value);
    var description = String(document.getElementById('description').value);
    var fileList = document.getElementById('ajaxFile').files;
    var projectType = -1;
    var refineType = -1;
    var dataType = -1;
    var state;
    var refineField = document.getElementById('valueField');
    var refineList = Object();

    var projectRadio = document.getElementsByName('projectType');
    var dataRadio = document.getElementsByName('dataType');
    var refineRadio = document.getElementsByName('refineType')
    var fileNames = Object();

    for(var i = 0 ; i < 3 ; i++)
      if(projectRadio[i].checked == true) projectType = i.toString();

    for(var i = 0 ; i < 3 ; i++)
      if(dataRadio[i].checked == true) dataType = i.toString();

    for(var i = 0 ; i < 4 ; i++)
      if(refineRadio[i].checked == true) refineType = i.toString();

    for(var i = 0 ; i < refineField.childElementCount ; i++) {
      console.log(refineField.children[i].value);
      refineList[i] = refineField.children[i].value;
    }

    console.log(refineList);

    if(projectType == 1) state = '1';
    else state = '0';

    if(fileList.length < 1 || refineType < 0 || dataType < 0 || projectType < 0) return;

    for(var i = 0 ; i < fileList.length ; i++)
      fileNames[i] = fileList[i].name;

    fileNames = JSON.stringify(fileNames);
    refineList = JSON.stringify(refineList);

    try {
      $.ajax({
        type : 'post',
        url : '/upload/register',
        data: {
          projectName : projectName,
          projectType : projectType,
          refineType : refineType,
          dataType : dataType,
          refine : refine,
          state : state,
          description : description,
          credit : credit,
          refineList : refineList,
          fileNames : fileNames,
        },
        dataType : 'json',
      })
    } catch(rejectedValue){

    }

    for (var i = 0; i < fileList.length; i++) {
      var fileURL = '/upload/url/' + projectName + '/' + i.toString() + '/' + fileList[i].name;
      var sendFile = fileList[i];

      console.log(fileURL);

      $.ajax({
        type: 'get',
        url: fileURL,
        success: function (url) {
          $.ajax({
            type: 'put',
            url: url,
            contentType: 'false',
            processData: false,
            data: sendFile,
          })
        },
        error: function (err) {
          console.log(err);
        }
      })
    }
  }

